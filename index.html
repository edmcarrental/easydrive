<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EasyDrive Full Dashboard</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif;}
body{min-height:100vh;display:flex;}
/* Sidebar */
.sidebar{width:220px;background:#2c3e50;color:#ecf0f1;flex-shrink:0;display:none;overflow-y:auto;}
.sidebar h2{text-align:center;padding:20px 0;font-size:18px;}
.sidebar ul{list-style:none;padding:0;}
.sidebar li{padding:12px 20px;cursor:pointer;display:flex;align-items:center;}
.sidebar li:hover{background:#34495e;}
/* Main */
.main{flex:1;background:#ecf0f1;display:flex;flex-direction:column;display:none;overflow:hidden;}
/* Header */
.header{height:60px;background:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 20px;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.header .logo{display:flex;align-items:center;}
.header .logo img{height:40px;margin-right:10px;cursor:pointer;}
.header .stats{display:flex;gap:10px;}
.header .stats div{background:#3498db;color:#fff;padding:5px 10px;border-radius:5px;font-size:14px;}
/* Content */
.content{flex:1;padding:20px;overflow:auto;}
table{width:100%;border-collapse: collapse;margin-top:10px;font-size:12px;}
th, td{padding:6px;border:1px solid #bdc3c7;text-align:left;}
th{background:#3498db;color:#fff;}
button{padding:4px 8px;border:none;border-radius:3px;cursor:pointer;margin:2px;}
.screen{width:100%;height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column;background:#ecf0f1;}
.screen input,.screen select{padding:8px;margin:5px 0;width:200px;}
.screen button{margin-top:10px;}
.status-Pending{background:yellow;color:black;}
.status-Approved{background:green;color:white;}
.status-Completed{background:blue;color:white;}
.status-Rejected{background:red;color:white;}
@media(max-width:768px){.sidebar{width:60px;}.sidebar li{font-size:12px;padding:10px 10px;}.header .stats{display:none;}}
</style>
</head>
<body>

<!-- SignUp/Login Screens -->
<div id="signupScreen" class="screen">
<h2>Sign Up</h2>
<input type="text" id="fullName" placeholder="Full Name">
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<select id="roleSelect">
<option value="admin">Admin</option>
<option value="partner">Partner</option>
<option value="client">Client</option>
</select>
<button onclick="signup()">Sign Up</button>
<p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
</div>

<div id="loginScreen" class="screen" style="display:none;">
<h2>Login</h2>
<select id="loginRole">
<option value="admin">Admin</option>
<option value="partner">Partner</option>
<option value="client">Client</option>
</select>
<input type="text" id="loginUsername" placeholder="Username">
<input type="password" id="loginPassword" placeholder="Password">
<button onclick="login()">Login</button>
<p>Don't have account? <a href="#" onclick="showSignup()">Sign Up</a></p>
</div>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
<h2>EasyDrive</h2>
<ul id="menu"></ul>
</div>

<!-- Main Panel -->
<div class="main" id="mainPanel">
<div class="header">
<div class="logo">
<img src="https://via.placeholder.com/40" id="logo" alt="Logo" onclick="changeLogo()">
<span id="roleTitle">Dashboard</span>
</div>
<div class="stats" id="adminStats"></div>
<div>
<span id="userName">Welcome</span>
<button onclick="logout()">Logout</button>
</div>
</div>
<div class="content" id="mainContent"></div>
</div>

<script>
// ==== Data Persistence ====
let users = JSON.parse(localStorage.getItem('users'))||[];
let currentUser = null;
let currentRole = "";
let bookingsData = JSON.parse(localStorage.getItem('bookingsData'))||[];
let vehicleData = JSON.parse(localStorage.getItem('vehicleData'))||[];
let incomeData = JSON.parse(localStorage.getItem('incomeData'))||[];
let expensesData = JSON.parse(localStorage.getItem('expensesData'))||[];
let cashRecords = JSON.parse(localStorage.getItem('cashRecords'))||{cash:0,bpi:0,gcash:0,gotyme:0,maya:0,landbank:0};

// ==== Screens ====
function showLogin(){document.getElementById('signupScreen').style.display='none'; document.getElementById('loginScreen').style.display='flex';}
function showSignup(){document.getElementById('loginScreen').style.display='none'; document.getElementById('signupScreen').style.display='flex';}

// ==== SignUp ====
function signup(){
const name=document.getElementById('fullName').value.trim();
const username=document.getElementById('username').value.trim();
const password=document.getElementById('password').value.trim();
const role=document.getElementById('roleSelect').value;
if(!name||!username||!password){alert("All fields required"); return;}
if(users.find(u=>u.username===username)){alert("Username exists"); return;}
if(role==="admin" && users.find(u=>u.role==="admin")){alert("Admin already exists"); return;}
users.push({name, username, password, role});
localStorage.setItem('users', JSON.stringify(users));
alert("Sign Up successful. Please Login.");
showLogin();
}

// ==== Login ====
function login(){
const role=document.getElementById('loginRole').value;
const username=document.getElementById('loginUsername').value.trim();
const password=document.getElementById('loginPassword').value.trim();
const user=users.find(u=>u.username===username && u.password===password && u.role===role);
if(!user){alert("Invalid credentials"); return;}
currentUser=user; currentRole=role;
document.getElementById('loginScreen').style.display='none';
document.getElementById('signupScreen').style.display='none';
document.getElementById('sidebar').style.display='block';
document.getElementById('mainPanel').style.display='flex';
document.getElementById('userName').innerText="Welcome, "+user.name;
loadSidebar(role);
if(role==="admin") loadAdminDashboard();
else if(role==="partner") loadPartnerDashboard();
else loadClientDashboard();
}

// ==== Logout ====
function logout(){location.reload();}

// ==== Sidebar Menu ====
function loadSidebar(role){
    const menuItems = role==="admin"?[
        "Dashboard","Clients","Partners","Vehicles","Add Vehicle","Bookings",
        "Income","Expenses","Net Cashflow","Cash Record","Logout"
    ]
    :role==="partner"?["Dashboard","My Trips","Earnings","Profile","Map","Facebook","TikTok","Logout"]
    :["Dashboard","My Bookings","Billing","Profile","Map","Facebook","TikTok","Logout"];

    const menu=document.getElementById('menu'); menu.innerHTML="";
    menuItems.forEach(item=>{
        const li=document.createElement('li'); li.innerText=item;
        li.onclick=()=>loadContent(item);
        menu.appendChild(li);
    });
}

// ==== Admin Dashboard ====
function loadAdminDashboard(){
let html=`<h2>Admin Dashboard</h2>`;
// Bookings Table
html+=`<h3>Recent Bookings</h3>
<table id="bookingsTable">
<tr><th>Client</th><th>Vehicle</th><th>Pick-Up</th><th>Return</th><th>Duration</th><th>Status</th></tr>`;
bookingsData.forEach((b,i)=>{
html+=`<tr>
<td>${b.client}</td>
<td>${b.vehicle}</td>
<td>${b.pickUp}</td>
<td>${b.return}</td>
<td>${b.duration}</td>
<td>
<select onchange="updateBookingStatus(${i},this.value)">
<option value="Pending" ${b.status==='Pending'?'selected':''}>Pending</option>
<option value="Approved" ${b.status==='Approved'?'selected':''}>Approved</option>
<option value="Completed" ${b.status==='Completed'?'selected':''}>Completed</option>
<option value="Rejected" ${b.status==='Rejected'?'selected':''}>Rejected</option>
</select>
</td>
</tr>`;
});
html+=`</table><button onclick="exportCSV('bookings')">Export Bookings CSV</button>`;

// Vehicles Table
html+=`<h3>Vehicles</h3>
<table id="vehiclesTable">
<tr><th>Name/Model</th><th>Plate</th><th>Year</th></tr>`;
vehicleData.forEach(v=>{
html+=`<tr><td>${v.name}</td><td>${v.plate}</td><td>${v.year}</td></tr>`;
});
html+=`</table>`;

// Income Table
html+=`<h3>Income</h3>
<table id="incomeTable"><tr><th>Cash</th><th>BPI</th><th>Gcash</th><th>DeliveryFee</th><th>CarWash</th><th>FuelDeficit</th><th>ReservationFee</th><th>Deposit</th></tr>`;
incomeData.forEach(i=>{
html+=`<tr>
<td>${i.cash||0}</td><td>${i.bpi||0}</td><td>${i.gcash||0}</td>
<td>${i.deliveryFee||0}</td><td>${i.carWash||0}</td><td>${i.fuelDeficit||0}</td>
<td>${i.reservationFee||0}</td><td>${i.deposit||0}</td>
</tr>`;
});
html+=`</table>`;

// Expenses Table
html+=`<h3>Expenses</h3>
<table id="expensesTable"><tr><th>Cash</th><th>BPI</th><th>Gcash</th><th>Category</th><th>Description</th></tr>`;
expensesData.forEach(e=>{
html+=`<tr>
<td>${e.cash||0}</td><td>${e.bpi||0}</td><td>${e.gcash||0}</td>
<td>${e.category||''}</td><td>${e.description||''}</td>
</tr>`;
});
html+=`</table>`;

// Net Cashflow
html+=`<h3>Net Cashflow</h3>
<p>Total Income: ₱${calculateTotalIncome()}</p>
<p>Total Expenses: ₱${calculateTotalExpenses()}</p>
<p>Net Revenue: ₱${calculateTotalIncome()-calculateTotalExpenses()}</p>`;

// Cash Records
html+=`<h3>Cash Records</h3>
<table id="cashRecordsTable"><tr><th>Cash</th><th>BPI</th><th>Gcash</th><th>Gotyme</th><th>Maya</th><th>Landbank</th></tr>
<tr><td>${cashRecords.cash}</td><td>${cashRecords.bpi}</td><td>${cashRecords.gcash}</td><td>${cashRecords.gotyme}</td><td>${cashRecords.maya}</td><td>${cashRecords.landbank}</td></tr></table>`;

mainContent.innerHTML=html;
updateTotals();
}

// ==== Update Booking Status ====
function updateBookingStatus(index,value){
bookingsData[index].status=value;
localStorage.setItem('bookingsData',JSON.stringify(bookingsData));
updateTotals();
}

// ==== Add Vehicle ====
function loadAddVehicle(){
let html=`<h2>Add Vehicle</h2>
<input type="text" id="vehicleName" placeholder="Vehicle Name/Model">
<input type="text" id="vehiclePlate" placeholder="Plate Number">
<input type="text" id="vehicleYear" placeholder="Year">
<button onclick="addVehicle()">Add Vehicle</button>
<h3>Current Vehicles</h3>
<table id="vehiclesTable"><tr><th>Name/Model</th><th>Plate</th><th>Year</th></tr></table>`;
mainContent.innerHTML=html;
updateVehiclesTable();
}

function addVehicle(){
const name=document.getElementById('vehicleName').value.trim();
const plate=document.getElementById('vehiclePlate').value.trim();
const year=document.getElementById('vehicleYear').value.trim();
if(!name||!plate||!year){alert("All fields required"); return;}
vehicleData.push({name, plate, year});
localStorage.setItem('vehicleData',JSON.stringify(vehicleData));
alert("Vehicle added successfully!");
document.getElementById('vehicleName').value="";
document.getElementById('vehiclePlate').value="";
document.getElementById('vehicleYear').value="";
updateVehiclesTable();
}

function updateVehiclesTable(){
const table=document.getElementById('vehiclesTable');
table.innerHTML=`<tr><th>Name/Model</th><th>Plate</th><th>Year</th></tr>`;
vehicleData.forEach(v=>{
const tr=document.createElement('tr');
tr.innerHTML=`<td>${v.name}</td><td>${v.plate}</td><td>${v.year}</td>`;
table.appendChild(tr);
});
}

// ==== Partner Dashboard ====
function loadPartnerDashboard(){
let html=`<h2>Partner Dashboard</h2><h3>My Trips</h3>
<table><tr><th>Client</th><th>Vehicle</th><th>Pick-Up</th><th>Return</th><th>Status</th></tr>`;
bookingsData.forEach(b=>{
html+=`<tr>
<td>${b.client}</td><td>${b.vehicle}</td><td>${b.pickUp}</td><td>${b.return}</td><td>${b.status}</td>
</tr>`;
});
html+=`</table>`;
mainContent.innerHTML=html;
}

// ==== Client Dashboard ====
function loadClientDashboard(){
let html=`<h2>Client Dashboard</h2>
<h3>Create Booking</h3>
<input type="text" id="bookingVehicle" placeholder="Vehicle">
<input type="datetime-local" id="bookingPickUp">
<input type="datetime-local" id="bookingReturn">
<button onclick="addBooking()">Book Now</button>
<h3>My Bookings</h3>
<table id="clientBookingsTable"><tr><th>Vehicle</th><th>Pick-Up</th><th>Return</th><th>Status</th></tr></table>`;
mainContent.innerHTML=html;
updateClientBookingsTable();
}

function addBooking(){
const vehicle=document.getElementById('bookingVehicle').value.trim();
const pickUp=document.getElementById('bookingPickUp').value;
const returnTime=document.getElementById('bookingReturn').value;
if(!vehicle||!pickUp||!returnTime){alert("All fields required"); return;}
const duration=(new Date(returnTime)-new Date(pickUp))/(1000*60*60);
bookingsData.push({client:currentUser.name, vehicle, pickUp, return:returnTime, duration, status:"Pending"});
localStorage.setItem('bookingsData',JSON.stringify(bookingsData));
alert("Booking created!");
updateClientBookingsTable();
}

function updateClientBookingsTable(){
const table=document.getElementById('clientBookingsTable');
table.innerHTML=`<tr><th>Vehicle</th><th>Pick-Up</th><th>Return</th><th>Status</th></tr>`;
bookingsData.filter(b=>b.client===currentUser.name).forEach(b=>{
const tr=document.createElement('tr');
tr.innerHTML=`<td>${b.vehicle}</td><td>${b.pickUp}</td><td>${b.return}</td><td>${b.status}</td>`;
table.appendChild(tr);
});
}

// ==== Load Content ====
const mainContent=document.getElementById('mainContent');
function loadContent(item){
if(item==="Logout"){logout(); return;}
if(currentRole==="admin"){
if(item==="Dashboard"){loadAdminDashboard(); return;}
if(item==="Add Vehicle"){loadAddVehicle(); return;}
mainContent.innerHTML=`<h2>${item}</h2><p contenteditable="true">Edit ${item} info here...</p>`;
}
else if(currentRole==="partner"){loadPartnerDashboard();}
else{loadClientDashboard();}
}

// ==== Totals ====
function calculateTotalIncome(){
return incomeData.reduce((sum,i)=>sum+(parseFloat(i.cash||0)+parseFloat(i.bpi||0)+parseFloat(i.gcash||0)+parseFloat(i.deliveryFee||0)+parseFloat(i.carWash||0)+parseFloat(i.fuelDeficit||0)+parseFloat(i.reservationFee||0)+parseFloat(i.deposit||0)),0);
}
function calculateTotalExpenses(){
return expensesData.reduce((sum,e)=>sum+(parseFloat(e.cash||0)+parseFloat(e.bpi||0)+parseFloat(e.gcash||0)),0);
}
function updateTotals(){
cashRecords.cash = calculateTotalIncome()-calculateTotalExpenses();
cashRecords.bpi = calculateTotalIncome()/2;
cashRecords.gcash = calculateTotalIncome()/2;
localStorage.setItem('cashRecords',JSON.stringify(cashRecords));
}

// ==== CSV Export ====
function exportCSV(type){
let csv="";
if(type==="bookings"){
csv="Client,Vehicle,Pick-Up,Return,Duration,Status\n";
bookingsData.forEach(b=>{csv+=`${b.client},${b.vehicle},${b.pickUp},${b.return},${b.duration},${b.status}\n`;});
}
const blob=new Blob([csv],{type:'text/csv'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a'); a.href=url; a.download=type+'.csv'; a.click();
}

// ==== Change Logo ====
function changeLogo(){let url=prompt("Enter new logo URL"); if(url) document.getElementById('logo').src=url;}
</script>
</body>
</html>
