<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EasyDrive Admin Dashboard</title>
<!-- Include CDN libraries -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<style>
    body { font-family: Arial, sans-serif; margin: 0; display: flex; background: #f4f4f4; }
    .sidebar { width: 280px; background: #2c3e50; color: white; height: 100vh; padding: 20px; box-sizing: border-box; }
    .sidebar h2 { margin-top: 0; }
    .sidebar section { margin-bottom: 30px; }
    .sidebar section h3 { font-size: 16px; margin-bottom: 10px; }
    .sidebar .panel { background: #34495e; padding: 10px; border-radius: 5px; }

    .main { flex: 1; padding: 20px; overflow-y: scroll; }
    .metrics { display: flex; gap: 20px; margin-bottom: 20px; }
    .card { background: white; padding: 20px; border-radius: 5px; flex: 1; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .card h3 { margin: 0; font-size: 16px; }
    .card p { font-size: 24px; margin-top: 10px; }

    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #2980b9; color: white; }
    tr.completed { background: #d4edda; }
    tr.upcoming { background: #d1ecf1; }
    tr.cancelled { background: #f8d7da; }

    .calendar { margin-top: 20px; background: white; padding: 20px; border-radius: 5px; }
    .booking-actions button { margin-right: 5px; }

    /* Modals */
    .modal { display: none; position: fixed; top:0; left:0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    .modal-content { background: white; padding: 20px; border-radius: 5px; width: 500px; max-width: 90%; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; }
    .close { cursor: pointer; }
</style>
</head>
<body>

<div class="sidebar">
    <h2>EasyDrive Admin</h2>

    <section>
        <h3>Cash Balances</h3>
        <div class="panel">
            <p>CASH: ₱<span id="cashBalance">3436</span></p>
            <p>BPI: ₱<span id="bpiBalance">9159.33</span></p>
            <p>GCASH: ₱<span id="gcashBalance">4367.75</span></p>
            <p>GoTyme: ₱<span id="gotymeBalance">0</span></p>
            <p><strong>Total: ₱<span id="totalCash">16963.08</span></strong></p>
        </div>
    </section>

    <section>
        <h3>Expenses (Car-related)</h3>
        <div class="panel">
            <p>Gas: ₱<span id="expenseGas">5000</span></p>
            <p>Service: ₱<span id="expenseService">3000</span></p>
            <p>Car Wash: ₱<span id="expenseWash">1000</span></p>
            <p>Promotions: ₱<span id="expensePromo">500</span></p>
            <p><strong>Total Expenses: ₱<span id="totalExpenses">9500</span></strong></p>
        </div>
    </section>

    <section>
        <h3>Pending Approvals</h3>
        <div class="panel" id="pendingApprovalsPanel">
            <p>No pending approvals.</p>
        </div>
    </section>
</div>

<div class="main">

    <div class="metrics">
        <div class="card">
            <h3>Total Bookings (Month)</h3>
            <p id="totalBookings">0</p>
        </div>
        <div class="card">
            <h3>Total Income (Month)</h3>
            <p id="totalIncome">₱0</p>
        </div>
        <div class="card">
            <h3>Total Expenses (Month)</h3>
            <p id="totalExpenseMain">₱0</p>
        </div>
        <div class="card">
            <h3>Vehicles Rented</h3>
            <p id="vehiclesRented">0</p>
        </div>
    </div>

    <div class="card">
        <h3>Top 5 Most Rented Vehicles</h3>
        <canvas id="topVehiclesChart"></canvas>
    </div>

    <table id="recentBookings">
        <thead>
            <tr>
                <th>Client Name</th>
                <th>Vehicle</th>
                <th>Pickup</th>
                <th>Return</th>
                <th>Duration</th>
                <th>Total Days Rented</th>
                <th>Status</th>
                <th>Freebies (Admin Only)</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <div class="calendar">
        <h3>Booking Calendar</h3>
        <input type="text" id="calendarInput" placeholder="Select Date Range" />
        <button id="addBookingBtn">Add Booking</button>
    </div>

</div>

<!-- Booking Modal -->
<div class="modal" id="bookingModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Booking</h3>
            <span class="close" id="closeModal">&times;</span>
        </div>
        <div class="modal-body">
            <form id="bookingForm">
                <label>Client Name: <input type="text" id="clientName" required></label><br><br>
                <label>Vehicle: <input type="text" id="vehicleName" required></label><br><br>
                <label>Pickup Date & Time: <input type="datetime-local" id="pickupDate" required></label><br><br>
                <label>Return Date & Time: <input type="datetime-local" id="returnDate" required></label><br><br>
                <label>Base Rate (₱): <input type="number" id="baseRate" required></label><br><br>
                <label>Extra Fees (₱): <input type="number" id="extraFees" value="0"></label><br><br>
                <label>Partner Unit? <input type="checkbox" id="isPartner"></label><br><br>
                <button type="submit">Save Booking</button>
            </form>
        </div>
    </div>
</div>

<script>
// Sample data storage
let bookings = [];
let vehicleUsage = {};
let vehicleCounts = {};

// Cash & Expenses
let totalExpenses = 9500;
let totalIncome = 0;

function updateMetrics() {
    document.getElementById('totalBookings').innerText = bookings.length;
    document.getElementById('totalIncome').innerText = '₱' + totalIncome.toFixed(2);
    document.getElementById('totalExpenseMain').innerText = '₱' + totalExpenses.toFixed(2);

    let rentedVehicles = bookings.filter(b => b.status !== 'Cancelled').length;
    document.getElementById('vehiclesRented').innerText = rentedVehicles;

    // Update Top 5 Vehicles
    vehicleCounts = {};
    bookings.forEach(b => {
        if(b.status !== 'Cancelled') {
            vehicleCounts[b.vehicle] = (vehicleCounts[b.vehicle] || 0) + 1;
        }
    });
    let sortedVehicles = Object.entries(vehicleCounts).sort((a,b) => b[1]-a[1]).slice(0,5);
    let labels = sortedVehicles.map(v => v[0]);
    let data = sortedVehicles.map(v => v[1]);

    topVehiclesChart.data.labels = labels;
    topVehiclesChart.data.datasets[0].data = data;
    topVehiclesChart.update();
}

// Freebies logic
function getFreebie(totalDays){
    if(totalDays >= 30) return 'T-shirt';
    if(totalDays >= 15) return 'Payong';
    if(totalDays >= 7) return 'Tote Bag';
    if(totalDays >= 1) return 'Keychain';
    return '';
}

function refreshBookingsTable(){
    let tbody = document.querySelector('#recentBookings tbody');
    tbody.innerHTML = '';
    bookings.forEach((b,i) => {
        let tr = document.createElement('tr');
        tr.className = b.status.toLowerCase();
        tr.innerHTML = `
            <td>${b.client}</td>
            <td>${b.vehicle}</td>
            <td>${b.pickup}</td>
            <td>${b.return}</td>
            <td>${b.duration} hrs</td>
            <td>${b.totalDays}</td>
            <td>${b.status}</td>
            <td>${b.freebie}</td>
            <td class="booking-actions">
                <button onclick="approveBooking(${i})">Approve</button>
                <button onclick="rejectBooking(${i})">Reject</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function approveBooking(index){
    bookings[index].status = 'Completed';
    alert(`Booking approved. Freebie: ${bookings[index].freebie || 'None'}`);
    totalIncome += bookings[index].baseRate + bookings[index].extraFees;
    updateMetrics();
    refreshBookingsTable();
}

function rejectBooking(index){
    bookings[index].status = 'Cancelled';
    alert('Booking rejected.');
    updateMetrics();
    refreshBookingsTable();
}

// Top 5 Pie Chart
const ctx = document.getElementById('topVehiclesChart').getContext('2d');
const topVehiclesChart = new Chart(ctx, {
    type: 'pie',
    data: {
        labels: [],
        datasets: [{
            label: 'Top 5 Vehicles',
            data: [],
            backgroundColor: ['#3498db','#e74c3c','#f1c40f','#2ecc71','#9b59b6']
        }]
    },
    options: { responsive: true }
});

// Booking Modal Logic
const modal = document.getElementById('bookingModal');
const addBtn = document.getElementById('addBookingBtn');
const closeModal = document.getElementById('closeModal');
addBtn.onclick = ()=>{ modal.style.display='flex'; }
closeModal.onclick = ()=>{ modal.style.display='none'; }
window.onclick = (e)=>{ if(e.target==modal) modal.style.display='none'; }

// Booking Form Submission
document.getElementById('bookingForm').onsubmit = function(e){
    e.preventDefault();
    let client = document.getElementById('clientName').value;
    let vehicle = document.getElementById('vehicleName').value;
    let pickup = document.getElementById('pickupDate').value;
    let ret = document.getElementById('returnDate').value;
    let baseRate = parseFloat(document.getElementById('baseRate').value);
    let extraFees = parseFloat(document.getElementById('extraFees').value);
    let isPartner = document.getElementById('isPartner').checked;

    let duration = (new Date(ret) - new Date(pickup)) / (1000*60*60); // hours
    let totalDays = Math.ceil(duration/24);
    let freebie = getFreebie(totalDays);

    bookings.push({client, vehicle, pickup, return: ret, baseRate, extraFees, status:'Upcoming', duration, totalDays, freebie, isPartner});
    modal.style.display='none';

    refreshBookingsTable();
    updateMetrics();
}

// Initialize Flatpickr
flatpickr('#calendarInput', {mode:'range'});
</script>

</body>
</html>
