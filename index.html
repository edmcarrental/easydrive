<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EasyDrive Full Dashboard</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif;}
body{min-height:100vh;display:flex;}
/* Sidebar */
.sidebar{width:220px;background:#2c3e50;color:#ecf0f1;flex-shrink:0;display:none;overflow-y:auto;}
.sidebar h2{text-align:center;padding:20px 0;font-size:18px;}
.sidebar ul{list-style:none;padding:0;}
.sidebar li{padding:12px 20px;cursor:pointer;display:flex;align-items:center;}
.sidebar li:hover{background:#34495e;}
/* Main */
.main{flex:1;background:#ecf0f1;display:flex;flex-direction:column;display:none;overflow:hidden;}
/* Header */
.header{height:60px;background:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 20px;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.header .logo{display:flex;align-items:center;}
.header .logo img{height:40px;margin-right:10px;cursor:pointer;}
.header .stats{display:flex;gap:10px;}
.header .stats div{background:#3498db;color:#fff;padding:5px 10px;border-radius:5px;font-size:14px;}
/* Content */
.content{flex:1;padding:20px;overflow:auto;}
table{width:100%;border-collapse: collapse;margin-top:10px;font-size:12px;}
th, td{padding:6px;border:1px solid #bdc3c7;text-align:left;}
th{background:#3498db;color:#fff;}
button{padding:4px 8px;border:none;border-radius:3px;cursor:pointer;margin:2px;}
.screen{width:100%;height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column;background:#ecf0f1;}
.screen input,.screen select{padding:8px;margin:5px 0;width:200px;}
.screen button{margin-top:10px;}
canvas{background:#fff;border:1px solid #ccc;margin-top:10px;}
.status-Pending{background:yellow;color:black;}
.status-Approved{background:green;color:white;}
.status-Completed{background:blue;color:white;}
.status-Rejected{background:red;color:white;}
@media(max-width:768px){.sidebar{width:60px;}.sidebar li{font-size:12px;padding:10px 10px;}.header .stats{display:none;}}
</style>
</head>
<body>

<!-- SignUp/Login Screens -->
<div id="signupScreen" class="screen">
<h2>Sign Up</h2>
<input type="text" id="fullName" placeholder="Full Name">
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<select id="roleSelect">
<option value="admin">Admin</option>
<option value="partner">Partner</option>
<option value="client">Client</option>
</select>
<button onclick="signup()">Sign Up</button>
<p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
</div>

<div id="loginScreen" class="screen" style="display:none;">
<h2>Login</h2>
<select id="loginRole">
<option value="admin">Admin</option>
<option value="partner">Partner</option>
<option value="client">Client</option>
</select>
<input type="text" id="loginUsername" placeholder="Username">
<input type="password" id="loginPassword" placeholder="Password">
<button onclick="login()">Login</button>
<p>Don't have account? <a href="#" onclick="showSignup()">Sign Up</a></p>
</div>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
<h2>EasyDrive</h2>
<ul id="menu"></ul>
</div>

<!-- Main Panel -->
<div class="main" id="mainPanel">
<div class="header">
<div class="logo">
<img src="https://via.placeholder.com/40" id="logo" alt="Logo" onclick="changeLogo()">
<span id="roleTitle">Dashboard</span>
</div>
<div class="stats" id="adminStats"></div>
<div>
<span id="userName">Welcome</span>
<button onclick="logout()">Logout</button>
</div>
</div>
<div class="content" id="mainContent"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ==== Data ====
let users = JSON.parse(localStorage.getItem('users'))||[];
let currentUser = null;
let currentRole = "";
let bookingsData = [
{client:"Juan Dela Cruz", vehicle:"Toyota Vios", plate:"ABC123", pickUp:"2025-08-16 09:00", return:"2025-08-17 09:00", duration:1, status:"Pending"},
{client:"Maria Santos", vehicle:"Honda City", plate:"XYZ789", pickUp:"2025-08-17 10:00", return:"2025-08-18 10:00", duration:1, status:"Approved"},
];
let incomeData = [
{cash:1000,bpi:2000,gcash:500,deliveryFee:100,carWash:50,fuelDeficit:0,reservationFee:0,deposit:0}
];
let expensesData = [{cash:200,bpi:300,gcash:100,category:"Maintenance",description:"Car wash"}];
let cashflowData = [{RFID:0,reservationFee:0,deposit:0,cash:0,bpi:0,gcash:0}];
let cashRecords = {cash:0,bpi:0,gcash:0,gotyme:0,maya:0,landbank:0};
let pieChart=null;

// ==== Screens ====
function showLogin(){document.getElementById('signupScreen').style.display='none'; document.getElementById('loginScreen').style.display='flex';}
function showSignup(){document.getElementById('loginScreen').style.display='none'; document.getElementById('signupScreen').style.display='flex';}

// ==== SignUp ====
function signup(){
const name=document.getElementById('fullName').value.trim();
const username=document.getElementById('username').value.trim();
const password=document.getElementById('password').value.trim();
const role=document.getElementById('roleSelect').value;
if(!name||!username||!password){alert("All fields required"); return;}
if(users.find(u=>u.username===username)){alert("Username exists"); return;}
if(role==="admin" && users.find(u=>u.role==="admin")){alert("Admin already exists"); return;}
users.push({name, username, password, role});
localStorage.setItem('users', JSON.stringify(users));
alert("Sign Up successful. Please Login.");
showLogin();
}

// ==== Login ====
function login(){
const role=document.getElementById('loginRole').value;
const username=document.getElementById('loginUsername').value.trim();
const password=document.getElementById('loginPassword').value.trim();
const user=users.find(u=>u.username===username && u.password===password && u.role===role);
if(!user){alert("Invalid credentials"); return;}
currentUser=user; currentRole=role;
document.getElementById('loginScreen').style.display='none';
document.getElementById('signupScreen').style.display='none';
document.getElementById('sidebar').style.display='block';
document.getElementById('mainPanel').style.display='flex';
document.getElementById('userName').innerText="Welcome, "+user.name;
loadSidebar(role);
if(role==="admin") loadAdminDashboard();
else mainContent.innerHTML=`<h2>${role} Dashboard</h2><p>Edit info here...</p>`;
}

// ==== Logout ====
function logout(){location.reload();}

// ==== Sidebar Menu ====
function loadSidebar(role){
const menuItems = role==="admin"?["Dashboard","Clients","Partners","Vehicles","Bookings","Income","Expenses","Net Cashflow","Cash Record","Logout"]
:role==="partner"?["Dashboard","My Trips","Earnings","Profile","Map","Facebook","TikTok","Logout"]
:["Dashboard","My Bookings","Billing","Profile","Map","Facebook","TikTok","Logout"];
const menu=document.getElementById('menu'); menu.innerHTML="";
menuItems.forEach(item=>{
const li=document.createElement('li'); li.innerText=item;
li.onclick=()=>loadContent(item);
menu.appendChild(li);
});
}

// ==== Admin Dashboard ====
function loadAdminDashboard(){
let html=`<h2>Admin Dashboard</h2>`;
// Pie Chart
html+=`<canvas id="pieChart" width="400" height="200"></canvas>`;
// Recent Bookings Table
html+=`<h3>Recent Bookings</h3>
<table id="bookingsTable">
<tr><th>Client</th><th>Vehicle</th><th>Plate</th><th>Pick-Up</th><th>Return</th><th>Duration</th><th>Status</th></tr>`;
bookingsData.forEach(b=>{
html+=`<tr contenteditable="true" class="status-${b.status}">
<td>${b.client}</td><td>${b.vehicle}</td><td>${b.plate}</td>
<td>${b.pickUp}</td><td>${b.return}</td><td>${b.duration}</td><td>${b.status}</td></tr>`;
});
html+=`</table><button onclick="exportCSV('bookings')">Export Bookings CSV</button>`;
mainContent.innerHTML=html;
renderPieChart();
updateTotals();
}

// ==== Pie Chart ====
function renderPieChart(){
const ctx=document.getElementById('pieChart').getContext('2d');
const vehicleCount={};
bookingsData.forEach(b=>{vehicleCount[b.vehicle]=(vehicleCount[b.vehicle]||0)+1;});
if(pieChart) pieChart.destroy();
pieChart=new Chart(ctx,{type:'pie',data:{labels:Object.keys(vehicleCount),datasets:[{data:Object.values(vehicleCount),backgroundColor:['#3498db','#e74c3c','#2ecc71','#f1c40f','#f39c12']}]},options:{responsive:true}});
}

// ==== Update Totals and Cash Records ====
function updateTotals(){
const totalIncome = incomeData.reduce((sum,i)=>sum+Object.values(i).reduce((a,b)=>a+(parseFloat(b)||0),0),0);
const totalExpenses = expensesData.reduce((sum,e)=>sum+Object.values(e).reduce((a,b)=>a+(parseFloat(b)||0),0),0);
const netRevenue = totalIncome - totalExpenses;
document.getElementById('adminStats').innerHTML=`
<div>Total Bookings: ${bookingsData.length}</div>
<div>Vehicles Rented: ${new Set(bookingsData.map(b=>b.vehicle)).size}</div>
<div>Total Income: ₱${totalIncome}</div>
<div>Total Expenses: ₱${totalExpenses}</div>
<div>Net Revenue: ₱${netRevenue}</div>
`;
// Update Cash Records demo
cashRecords.cash = totalIncome - totalExpenses;
cashRecords.bpi = totalIncome/2;
cashRecords.gcash = totalIncome/2;
cashRecords.gotyme = 0; cashRecords.maya=0; cashRecords.landbank=0;
}

// ==== Load Content ====
const mainContent=document.getElementById('mainContent');
function loadContent(item){
if(item==="Logout"){logout(); return;}
if(currentRole==="admin"){
if(item==="Dashboard"){loadAdminDashboard(); return;}
mainContent.innerHTML=`<h2>${item}</h2><p contenteditable="true">Edit ${item} info here...</p>`;
}
else mainContent.innerHTML=`<h2>${item}</h2><p contenteditable="true">Edit ${item} info here...</p>`;
}

// ==== Export CSV ====
function exportCSV(type){alert("Export CSV: "+type+" (implement as needed)");}

// ==== Change Logo ====
function changeLogo(){let url=prompt("Enter new logo URL"); if(url) document.getElementById('logo').src=url;}
</script>
</body>
</html>
