<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EasyDrive Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4;}
  .navbar { background:#004080; color:white; padding:10px; display:flex; justify-content:space-between; align-items:center;}
  .sidebar { width:250px; background:#fff; height:100vh; position:fixed; top:0; left:0; padding:20px; box-shadow:2px 0 5px rgba(0,0,0,0.1);}
  .main { margin-left:270px; padding:20px;}
  .card { background:white; padding:15px; margin-bottom:15px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
  table { width:100%; border-collapse:collapse; margin-top:10px;}
  th, td { border:1px solid #ddd; padding:8px; text-align:left;}
  th { background:#004080; color:white;}
  .green { color:green; font-weight:bold;}
  .blue { color:#1e90ff; font-weight:bold;}
  .red { color:red; font-weight:bold;}
  .hidden { display:none; }
  .role-select { margin:20px;}
  button { padding:5px 10px; margin-right:5px; cursor:pointer;}
</style>
</head>
<body>

<div class="role-select">
  <label>Select Role: </label>
  <select id="roleSelect">
    <option value="">-- Choose Role --</option>
    <option value="admin">Admin</option>
    <option value="client">Client</option>
    <option value="partner">Partner</option>
  </select>
</div>

<!-- Admin / Partner / Client Panels -->
<div id="dashboardPanel" class="hidden">
  <div class="navbar">
    <div>EasyDrive Dashboard</div>
    <div id="currentRole"></div>
  </div>

  <div class="sidebar">
    <h3>Quick Stats</h3>
    <div>Total Income: ₱<span id="totalIncome">0</span></div>
    <div>Total Expense: ₱<span id="totalExpense">0</span></div>
    <div>Active Bookings: <span id="activeBookings">0</span></div>
    <div>Partner Applications: <span id="pendingPartners">0</span></div>
  </div>

  <div class="main">
    <div class="card">
      <h3>Top 5 Most Rented Vehicles</h3>
      <canvas id="topVehiclesChart" height="200"></canvas>
    </div>

    <div class="card">
      <h3>Recent Bookings</h3>
      <table id="bookingsTable">
        <thead>
          <tr>
            <th>Client Name</th>
            <th>Vehicle</th>
            <th>Pickup</th>
            <th>Return</th>
            <th>Duration</th>
            <th>Total Days Rented</th>
            <th>Status</th>
            <th class="admin-only">Freebies</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card client-only">
      <h3>Book a Vehicle</h3>
      <form id="bookingForm">
        <label>Client Name:</label><br>
        <input type="text" id="clientName" required><br>
        <label>Vehicle:</label><br>
        <select id="vehicleSelect"></select><br>
        <label>Pickup Date:</label><br>
        <input type="date" id="pickupDate" required><br>
        <label>Return Date:</label><br>
        <input type="date" id="returnDate" required><br>
        <button type="submit">Submit Booking</button>
      </form>
    </div>

    <div class="card partner-only">
      <h3>Submit Your Vehicle</h3>
      <form id="partnerForm">
        <label>Vehicle Name/Model:</label><br>
        <input type="text" id="partnerVehicle" required><br>
        <label>Plate Number:</label><br>
        <input type="text" id="partnerPlate" required><br>
        <button type="submit">Submit Vehicle</button>
      </form>
    </div>

  </div>
</div>

<script>
const roleSelect = document.getElementById('roleSelect');
const dashboardPanel = document.getElementById('dashboardPanel');
const currentRole = document.getElementById('currentRole');

let bookings = [];
let vehicles = [
  {name:'Toyota Vios', plate:'ABC123', rented:3},
  {name:'Honda City', plate:'DEF456', rented:5},
  {name:'Toyota Avanza', plate:'GHI789', rented:2},
  {name:'Mitsubishi Montero', plate:'JKL012', rented:1},
  {name:'Suzuki Ertiga', plate:'MNO345', rented:4},
];
let partners = [];
let totalIncome = 0;
let totalExpense = 0;

roleSelect.addEventListener('change', ()=>{
  const role = roleSelect.value;
  if(!role) { dashboardPanel.classList.add('hidden'); return; }
  dashboardPanel.classList.remove('hidden');
  currentRole.innerText = role.toUpperCase();

  // Show/hide sections
  document.querySelectorAll('.client-only').forEach(e=>e.style.display=(role==='client'?'block':'none'));
  document.querySelectorAll('.partner-only').forEach(e=>e.style.display=(role==='partner'?'block':'none'));
  document.querySelectorAll('.admin-only').forEach(e=>e.style.display=(role==='admin'?'table-cell':'none'));

  updateDashboard();
});

function updateDashboard(){
  // Stats
  totalIncome = bookings.reduce((sum,b)=>sum+b.amount,0);
  totalExpense = bookings.reduce((sum,b)=>sum+b.expense,0);
  document.getElementById('totalIncome').innerText = totalIncome;
  document.getElementById('totalExpense').innerText = totalExpense;
  document.getElementById('activeBookings').innerText = bookings.filter(b=>b.status==='Upcoming').length;
  document.getElementById('pendingPartners').innerText = partners.filter(p=>!p.approved).length;

  // Top Vehicles Pie Chart
  const ctx = document.getElementById('topVehiclesChart').getContext('2d');
  const sorted = vehicles.sort((a,b)=>b.rented-a.rented).slice(0,5);
  const data = {
    labels: sorted.map(v=>v.name),
    datasets:[{
      data: sorted.map(v=>v.rented),
      backgroundColor:['#004080','#1e90ff','#ff8c00','#32cd32','#ff1493']
    }]
  };
  if(window.vehicleChart) window.vehicleChart.destroy();
  window.vehicleChart = new Chart(ctx,{type:'pie',data:data});

  // Bookings Table
  const tbody = document.querySelector('#bookingsTable tbody');
  tbody.innerHTML='';
  bookings.forEach((b,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${b.client}</td>
      <td>${b.vehicle}</td>
      <td>${b.pickup}</td>
      <td>${b.return}</td>
      <td>${b.duration} days</td>
      <td>${b.totalDays}</td>
      <td class="${b.status==='Completed'?'green':b.status==='Upcoming'?'blue':'red'}">${b.status}</td>
      <td class="admin-only">${b.freebie || ''}</td>
      <td>
        ${roleSelect.value==='admin'?`<button onclick="approveBooking(${i})">Approve</button><button onclick="rejectBooking(${i})">Reject</button>`:''}
      </td>
    `;
    tbody.appendChild(tr);
  });

  // Vehicle Select for client
  const vehicleSelect = document.getElementById('vehicleSelect');
  vehicleSelect.innerHTML='';
  vehicles.forEach(v=>{
    vehicleSelect.innerHTML+=`<option value="${v.name}">${v.name}</option>`;
  });
}

// Booking Form Submission
document.getElementById('bookingForm')?.addEventListener('submit',(e)=>{
  e.preventDefault();
  const client = document.getElementById('clientName').value;
  const vehicle = document.getElementById('vehicleSelect').value;
  const pickup = document.getElementById('pickupDate').value;
  const ret = document.getElementById('returnDate').value;
  const duration = (new Date(ret)-new Date(pickup))/(1000*60*60*24)+1;
  const totalDays = duration;
  let freebie='';
  if(totalDays>=30) freebie='T-shirt';
  else if(totalDays>=15) freebie='Payong';
  else if(totalDays>=7) freebie='Tote Bag';
  else if(totalDays>=1) freebie='Keychain';

  bookings.push({client,vehicle,pickup,return:ret,duration,totalDays,status:'Upcoming',amount:1000*duration,expense:300*duration,freebie});
  const v = vehicles.find(vv=>vv.name===vehicle); if(v) v.rented++;
  updateDashboard();
  alert('Booking submitted! Waiting for admin approval.');
});

// Partner Form Submission
document.getElementById('partnerForm')?.addEventListener('submit',(e)=>{
  e.preventDefault();
  const name = document.getElementById('partnerVehicle').value;
  const plate = document.getElementById('partnerPlate').value;
  partners.push({name,plate,approved:false});
  updateDashboard();
  alert('Partner vehicle submitted! Waiting for admin approval.');
});

// Admin Approve/Reject
function approveBooking(i){
  bookings[i].status='Completed';
  updateDashboard();
  alert(`Booking for ${bookings[i].client} approved!`);
}
function rejectBooking(i){
  bookings[i].status='Cancelled';
  updateDashboard();
  alert(`Booking for ${bookings[i].client} rejected!`);
}
</script>

</body>
</html>
